<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íƒœê·¸ì˜¤ë” - ì •í†µ ì¶©ë¶ëŒ€ì§€ì </title>
  <link rel="stylesheet" href="for_menu_modify.css">
</head>
<body>
  <header class="header">
    <div class="top-bar">
    </div>
    <div class="store-info">
      <!--<button class="back-btn">â†</button>ì´ê±° ì–´ë””ì“¸ë§Œí•˜ì§€ì•Šì„ê¹Œ-->
      <h1>ì •ë³´í†µì‹ ê³µí•™ë¶€ ì¶©ë¶ëŒ€ ì§€ì </h1>
      <div class="header-icons">
        <button>ğŸ”—</button>
        <button>ğŸ”</button>
        <button>ğŸ›’</button>
      </div>
    </div>
  </header>

  <nav class="menu-tabs">
    <button>ë©”ë‰´ ì°¾ê¸°</button>
    <button class="active">ì¶”ì²œ ë©”ë‰´</button>
    <button>ì‹ ë©”ë‰´</button>
    <button>bhc ì„¸íŠ¸</button>
    <button>ë¿Œë§í´</button>
    <p>ë²„íŠ¼ì€ ì•„ì§ ì‘ë™ x</p>
  </nav>

  <main class="menu-list">
    <section class="menu-item">
      <div class="menu-info">
        <% items.forEach(item => { %>
          <div class="menu-container" onclick="openModal(<%= item.id %>, '<%= item.name %>', '<%= item.price %>', '<%= item.description %>')">
            <div class="menu-details">
            <h2><%= item.name %></h2>
            <p class="price"><%= item.price %>ì›</p>
            <p class="review"><%= item.description %></p>
            <form action = '/admin_addel' method="POST" onsubmit="event.preventDefault(); openConfirmModal(this);">
                <label class="moding_menu_button_label">
                    <input type="hidden" name="id" value="<%= item.id %>">
                    <button class="moding_menu_button" type="submit">ì‚­ì œ</button>
                </label>
            </form>
          </div>
            <img class="menu-img" src="/test_img_upload/<%= item.image_url %>" alt="<%= item.name %>">
          </div>
        <% }) %>
      </div>
    </section>

   <!--ì‚­ì œ í™•ì¸ ëª¨ë‹¬, ê´€ë ¨ ìŠ¤í¬ë¦½ í•¨ìˆ˜(openConfirmModal, closeConfirModal, confirmDelete)-->
    <section>
        <div id="confirmModal" class="confirm-modal">
          <div class="confirm-modal-content">
            <span class="close" onclick="closeConfirmModal()">&times;</span>
            <p>ì •ë§ë¡œ ì‚­ì œí•˜ê² ìŠµë‹ˆê¹Œ?</p>
            <button onclick="confirmDelete()">í™•ì¸</button>
            <button onclick="closeConfirmModal()">ì·¨ì†Œ</button>
          </div>
        </div>
    </section>

     <!--ëª¨ë‹¬ ê´€ë ¨ ì½”ë“œ-->
      <div id="myModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <h2 id="modal-menu-name"></h2>
          <p id="modal-price"></p>
          <p id="modal-description"></p>
          <div id="modal-options"></div>
          <button onclick="DoSendOrder()">ì£¼ë¬¸ í•˜ê¸°</button>
        </div>
      </div>

  </main>


  <!--ëª¨ë‹¬ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸, ë‚˜ì¤‘ì— jsíŒŒì¼ë¡œ ë”°ë¡œ ë¹¼ë†“ì„ ê²ƒ-->
  <script>
    let selectedMenu = '';//ì„ íƒí•œ ë©”ë‰´ ì´ë¦„ ì €ì¥
    let deleteForm;
    function openModal(id, name, price, description) {
        selectedMenu=name;
        document.getElementById('modal-menu-name').textContent = name;
        document.getElementById('modal-price').textContent = price + 'ì›';
        document.getElementById('modal-description').textContent = description;
        document.getElementById('myModal').style.display = 'block';

        // ëª¨ë‹¬ì„ ì—´ë©´ ê·¸ ë©”ë‰´ì— ë§ëŠ” ì˜µì…˜ë“¤ì„ ê°€ì ¸ì˜´
            fetch(`/getMenuOptions?id=${id}`)
                .then(response => response.json())
                .then(data => {
                    const optionsContainer = document.getElementById('modal-options');
                    optionsContainer.innerHTML = ''; // ì´ì „ì˜µì…˜ì„ ì´ˆê¸°í™”
                    data.options.forEach(option => {
                        const label = document.createElement('label');
                        label.innerHTML = `<p>${option.name}<input type="checkbox" id="option-${option.id}"></p>`;
                        optionsContainer.appendChild(label);
                    });
                })
                .catch(error => {
                    console.error('ì¶”ê°€ì˜µì…˜ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. :', error);
                });
    }

    function closeModal() {
        document.getElementById('myModal').style.display = 'none';
    }
  
    function DoSendOrder(name) { 
            fetch('/DoSendOrder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json' //HTTPì˜ ìš”ì²­ì´ JSONí˜•ì‹ì„ì„ ì•Œë¦¬ëŠ” í—¤ë”
                },
                body: JSON.stringify({ menu: selectedMenu })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeModal();
                } else {
                    alert('ì£¼ë¬¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ì£¼ë¬¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

     /*ì‚­ì œ í™•ì¸ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜*/
      function openConfirmModal(form) {
        deleteForm = form;
        document.getElementById('confirmModal').style.display = 'block';
      }

      function closeConfirmModal() {
        document.getElementById('confirmModal').style.display = 'none';
      }

      function confirmDelete() {
        deleteForm.submit();
      }
</script>
</body>
</html>